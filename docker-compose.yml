version: '3.8'

services:
  golem:
    build: .
    container_name: golem-watchtower
    restart: always
    environment:
      - LEDGER_URL=http://100.73.228.90:3000/planner/ops-ledger.git
      - NODE_NAME=watchtower
      - GITEA_TOKEN=${GITEA_TOKEN}
    command: ["http://100.73.228.90:3000/planner/ops-ledger.git", "watchtower"]
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  # Secure proxy for docker socket (optional but recommended in nisto docs)
  docker-proxy:
    image: tecnativa/docker-socket-proxy
    container_name: golem-docker-proxy
    restart: always
    environment:
      - CONTAINERS=1
      - IMAGES=1
      - NETWORKS=1
      - VOLUMES=1
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
